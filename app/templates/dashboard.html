{% extends "base.html" %}
{% block content %}
  <h1 class="h1">Dashboard</h1>
  <p class="sub">Hot conversations, organized into categories.</p>

  {% if not user.is_active_subscriber %}
    <div class="card" style="margin-bottom:16px">
      <b>Upgrade to unlock:</b> X ingestion, AI summaries, and higher limits.
      <div style="height:10px"></div>
      <a class="btn" href="/billing/checkout">Upgrade</a>
    </div>
  {% endif %}

  <div class="grid">
    <div class="card">
      <b>Ingest</b>
      <p class="small">Enter topics once to ingest from Reddit + X (X requires token).</p>

      <form method="post" action="/ingest/all">
        <label class="small">Topics (comma separated)</label>
        <input class="input" name="topics" value="food, nutrition, recipes" />
        <div style="height:10px"></div>
        <button class="btn" type="submit">Ingest</button>
      </form>

      <div style="height:14px"></div>

      <form method="post" action="/summaries/update">
        <label class="small">Update AI summaries</label>
        <div style="height:10px"></div>
        <button class="btn ghost" type="submit">Generate summaries</button>
      </form>

      <div style="height:12px"></div>
      <p class="small">{{ msg or "" }}</p>
    </div>

    <div class="card">
      <b>Categories</b>
      <table class="table">
        <tr><th>Category</th><th>Top Conversations</th></tr>
        {% for c in categories %}
          <tr>
            <td><a href="/dashboard?category={{ c.name }}">{{ c.name }}</a><div class="small">hot topic</div></td>
            <td class="small">
              {% if c.conversations %}
                {% for convo in c.conversations %}
                  <div style="margin-bottom:14px">
                    <div>{{ convo.summary }}</div>
                    <div style="margin-top:6px">
                      <a class="btn ghost" href="{{ convo.url }}" target="_blank">See the conversation</a>
                    </div>
                  </div>
                {% endfor %}
              {% else %}
                â€”
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </table>
    </div>
  </div>
{% endblock %}
